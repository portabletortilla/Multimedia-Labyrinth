<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/Page1.css">
    <title>testPage</title>
</head>

<body>
    <div class="MainScreen">

            <!-- Image Map Generated by http://www.image-map.net/ -->
        <img src="./graphics/pag_40.jpg" id="mainImage" usemap="#imageMap" onclick="startBAudio()">
        <div class ="Secret" ><a href="./extras/extra1.html">?</a> </div>
        <div id="Dialogue" hidden>
            <h3></h3>
        </div>
    </div>

    <div class="overlay" id="overlay" onclick="endOverlay()">
        <div class="oImg" id="oImg"></div>
        <div class="subtitles" id ="subtitles">
            
        </div>
    </div>

    <!--Audio Files-->
    <audio preload="auto" autoplay loop id="BackGroundNoise">
        <source src="./audio/windybackground.wav" type="audio/wav">
        If you're reading this it means that there is an issue with the sound in this page.We're Sorry!

    </audio>

</body>


<map name="imageMap">
    <area  alt="door1" title="door1"  coords="342,544,65,0" shape="rect" onclick = 'door1F()'>
    <area  alt="door2" title="door2"  coords="519,528,793,2" shape="rect" onclick = 'WriteResponse("Stuck beyond repair i fear" , "door_interact")'>
    <area  alt="paper" title="paper"  coords="1003,213,1088,235,1114,107,1036,69" shape="poly" onclick = 'paperF()'>
    <area  alt="heater" title="heater" coords="942,332,1107,510" shape="rect" onclick='WriteResponse("I have one similar, not quite as broken though")'>
    <area  alt="door3" title="door3"  coords="1434,533,1161,3" shape="rect" onclick='beginOverlay("Weird symbols were half hazardly scribed on the wood.... \n Creepy...",
    "mDoor")'>
    <area  alt="door4" title="door4"  coords="1605,523,1886,8" shape="rect" onclick='codedDoor()' >
</map>


<map name="dial-map">
    <area  alt="1" title="1"  coords="4,4,107,47" shape="rect" onclick="dialNumber('1')">
    <area  alt="2" title="2"  coords="125,6,236,50" shape="rect" onclick="dialNumber('2')">
    <area  alt="3" title="3"  coords="250,5,358,53" shape="rect" onclick="dialNumber('3')">
    <area  alt="4" title="4"  coords="7,62,111,103" shape="rect" onclick="dialNumber('4')">
    <area  alt="5" title="5" coords="124,61,235,101" shape="rect" onclick="dialNumber('5')">
    <area  alt="6" title="6"  coords="251,62,361,102" shape="rect" onclick="dialNumber('6')">
    <area  alt="7" title="7"  coords="6,113,109,154" shape="rect" onclick="dialNumber('7')">
    <area  alt="8" title="8"  coords="124,115,237,159" shape="rect" onclick="dialNumber('8')">
    <area  alt="9" title="9"  coords="252,113,362,157" shape="rect" onclick="dialNumber('9')">
    <area  alt="0" title="0"  coords="121,166,241,208" shape="rect" onclick="dialNumber('0')">
    <area  alt="Reset" title="Reset"  coords="248,160,359,211" shape="rect" onclick="resetDial()">
</map>

<!--Loading images in page , hidden to not cause bad overlays-->
<img src="./graphics/Mist_door.jpg"  id="mDoor" hidden>
<img src="./graphics/dial.png" usemap="#dial-map" id="dial" hidden>
<img src ="./graphics/Note.jpg" id="note" hidden>



<script src="./scripts/GenericScript.js"></script>


<script>
    localStorage.setItem("key",0);
    localStorage.setItem("door1State",0);
    localStorage.setItem("door2State",0);
    var subtitles = document.getElementById("subtitles");
    var timerDial;

    function paperF(){
        
        localStorage.setItem("key",1);

        //<br /> lets you get a new line.

        beginOverlay("A weird note hangs in the wall, desperately trying to fly of with the wind <br /> There seems to be something behing it...." , 
    "note" ,"paperA"," \" RUSTY KEY \" has been added to your Inventory");
    }

    function door1F(){
        if(localStorage.getItem("door1State")== 1){
            WriteResponse("Player enters room ... in the future","door_open")
            mainImageTransition("./graphics/test.png" ,"#imageMap");
            return;
        }

        if(localStorage.getItem("key")== 1){
            WriteResponse("The key turns with a satisfying click. <br /> The key broke, but at least the door's open. ","door_unlock")
            localStorage.setItem("key",0);
            localStorage.setItem("door1State",1);
            return;
        }

        WriteResponse("Doesnt want to open might just be locked though ","door_interact");

    }


    function codedDoor(){
        if(localStorage.getItem("door2State")==1){
            WriteResponse("Player enters room ... in the future","door_open")
        }
        else{
            localStorage.setItem("dial",'');
            beginOverlay("oh look, a keypad","dial")
        }
    }

    function resetDial(){
        localStorage.setItem("dial","");
        console.log(localStorage.getItem("dial"))
    }

    function dialNumber(num){
        if(localStorage.getItem("door2State")==1){
            subtitles.innerHTML = "The door is already unlocked";
            return;
        }

        console.log("playing ./audio/dial" +(num%3)+".wav")
        audio = new Audio("./audio/dial"+(num%3)+".wav");
        audio.play();

        clearTimeout(timerDial);
        timerDial = setTimeout(dialTimeout,10000);

        localStorage.setItem("dial",localStorage.getItem("dial") + num)
        p = localStorage.getItem("dial")
        console.log(p)
        subtitles.innerHTML = p;

        if(p.length == 6){
            clearTimeout(timerDial);
            checkPassword(p,"123098")
        }    
    }

    function dialTimeout(){
        
        audio = new Audio("./audio/punisherdan__timeout.ogg");
        audio.play();

        subtitles.innerHTML = "The dial is beeping impatiently, seems it reset...";
        localStorage.setItem("dial","");
    }

    function checkPassword(dialed,password){
        if(dialed== password){
            audio = new Audio("./audio/correct.wav");
            audio.play();
            subtitles.innerHTML = "The dials chime's a pleasing tune";
            localStorage.setItem("door2State",1)
        }
        else{
            subtitles.innerHTML = "The dials screechs an ungodly tune";
            localStorage.setItem("dial","");
        }
    }
</script>

</html>